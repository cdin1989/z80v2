;TMS9118 API.
;VDP Ports:
;0xBE: VDP Data (read/write)
;0xBF: VDP Address (write)
;0xBF: VDP Status Register (read)
;
;***********************************************************************
;* TMS9118 MEMORY MAP                                                  *
;*                          TEXT                                       *
;* PATTERN TABLE     : 0x0000 - 0x07FF                          2KB    *
;* NAME TABLE        : 0x0800 - 0x0BBF                          960    *
;* UNUSED            : 0x0BC0 - 0x3FFF                                 *
;***********************************************************************   

;VDP ports
VDP_VRAM EQU 0xBE
VDP_VREG EQU 0xBF

;VDP registers.
VDP_R0   EQU 0x80
VDP_R1   EQU 0x81
VDP_R2   EQU 0x82
VDP_R3   EQU 0x83
VDP_R4   EQU 0x84
VDP_R5   EQU 0x85
VDP_R6   EQU 0x86
VDP_R7   EQU 0x87

ORG 0x0000
    JP Start

ALIGN 0x0038
VBlank:
    CALL OnVBlank
    EI
    RETI

;Font table
FontTable:
    DB 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DB 0x38,0x44,0x6C,0x44,0x54,0x44,0x38,0x00
    DB 0x38,0x7C,0x54,0x7C,0x44,0x7C,0x38,0x00
    DB 0x00,0x28,0x7C,0x7C,0x7C,0x38,0x10,0x00
    DB 0x00,0x10,0x38,0x7C,0x7C,0x38,0x10,0x00
    DB 0x10,0x38,0x38,0x10,0x7C,0x7C,0x10,0x00
    DB 0x00,0x10,0x38,0x7C,0x7C,0x10,0x38,0x00
    DB 0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00
    DB 0xFC,0xFC,0xFC,0xCC,0xCC,0xFC,0xFC,0xFC
    DB 0x00,0x00,0x78,0x48,0x48,0x78,0x00,0x00
    DB 0xFC,0xFC,0x84,0xB4,0xB4,0x84,0xFC,0xFC
    DB 0x00,0x1C,0x0C,0x34,0x48,0x48,0x30,0x00
    DB 0x38,0x44,0x44,0x38,0x10,0x38,0x10,0x00
    DB 0x10,0x18,0x14,0x10,0x30,0x70,0x60,0x00
    DB 0x0C,0x34,0x2C,0x34,0x2C,0x6C,0x60,0x00
    DB 0x00,0x54,0x38,0x6C,0x38,0x54,0x00,0x00
    DB 0x20,0x30,0x38,0x3C,0x38,0x30,0x20,0x00
    DB 0x08,0x18,0x38,0x78,0x38,0x18,0x08,0x00
    DB 0x10,0x38,0x7C,0x10,0x7C,0x38,0x10,0x00
    DB 0x28,0x28,0x28,0x28,0x28,0x00,0x28,0x00
    DB 0x3C,0x54,0x54,0x34,0x14,0x14,0x14,0x00
    DB 0x38,0x44,0x30,0x28,0x18,0x44,0x38,0x00
    DB 0x00,0x00,0x00,0x00,0x00,0x78,0x78,0x00
    DB 0x10,0x38,0x7C,0x10,0x7C,0x38,0x10,0x38
    DB 0x10,0x38,0x7C,0x10,0x10,0x10,0x10,0x00
    DB 0x10,0x10,0x10,0x10,0x7C,0x38,0x10,0x00
    DB 0x00,0x10,0x18,0x7C,0x18,0x10,0x00,0x00
    DB 0x00,0x10,0x30,0x7C,0x30,0x10,0x00,0x00
    DB 0x00,0x00,0x00,0x40,0x40,0x40,0x7C,0x00
    DB 0x00,0x28,0x28,0x7C,0x28,0x28,0x00,0x00
    DB 0x10,0x10,0x38,0x38,0x7C,0x7C,0x00,0x00
    DB 0x7C,0x7C,0x38,0x38,0x10,0x10,0x00,0x00
    DB 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
    DB 0x10,0x38,0x38,0x10,0x10,0x00,0x10,0x00
    DB 0x6C,0x6C,0x48,0x00,0x00,0x00,0x00,0x00
    DB 0x00,0x28,0x7C,0x28,0x28,0x7C,0x28,0x00
    DB 0x20,0x38,0x40,0x30,0x08,0x70,0x10,0x00
    DB 0x64,0x64,0x08,0x10,0x20,0x4C,0x4C,0x00
    DB 0x20,0x50,0x50,0x20,0x54,0x48,0x34,0x00
    DB 0x30,0x30,0x20,0x00,0x00,0x00,0x00,0x00
    DB 0x10,0x20,0x20,0x20,0x20,0x20,0x10,0x00
    DB 0x20,0x10,0x10,0x10,0x10,0x10,0x20,0x00
    DB 0x00,0x28,0x38,0x7C,0x38,0x28,0x00,0x00
    DB 0x00,0x10,0x10,0x7C,0x10,0x10,0x00,0x00
    DB 0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x20
    DB 0x00,0x00,0x00,0x7C,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x00,0x00,0x00,0x30,0x30,0x00
    DB 0x00,0x04,0x08,0x10,0x20,0x40,0x00,0x00
    DB 0x38,0x44,0x4C,0x54,0x64,0x44,0x38,0x00
    DB 0x10,0x30,0x10,0x10,0x10,0x10,0x38,0x00
    DB 0x38,0x44,0x04,0x18,0x20,0x40,0x7C,0x00
    DB 0x38,0x44,0x04,0x38,0x04,0x44,0x38,0x00
    DB 0x08,0x18,0x28,0x48,0x7C,0x08,0x08,0x00
    DB 0x7C,0x40,0x40,0x78,0x04,0x44,0x38,0x00
    DB 0x18,0x20,0x40,0x78,0x44,0x44,0x38,0x00
    DB 0x7C,0x04,0x08,0x10,0x20,0x20,0x20,0x00
    DB 0x38,0x44,0x44,0x38,0x44,0x44,0x38,0x00
    DB 0x38,0x44,0x44,0x3C,0x04,0x08,0x30,0x00
    DB 0x00,0x00,0x30,0x30,0x00,0x30,0x30,0x00
    DB 0x00,0x00,0x30,0x30,0x00,0x30,0x30,0x20
    DB 0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x00
    DB 0x00,0x00,0x7C,0x00,0x00,0x7C,0x00,0x00
    DB 0x20,0x10,0x08,0x04,0x08,0x10,0x20,0x00
    DB 0x38,0x44,0x04,0x18,0x10,0x00,0x10,0x00
    DB 0x38,0x44,0x5C,0x54,0x5C,0x40,0x38,0x00
    DB 0x38,0x44,0x44,0x44,0x7C,0x44,0x44,0x00
    DB 0x78,0x44,0x44,0x78,0x44,0x44,0x78,0x00
    DB 0x38,0x44,0x40,0x40,0x40,0x44,0x38,0x00
    DB 0x78,0x44,0x44,0x44,0x44,0x44,0x78,0x00
    DB 0x7C,0x40,0x40,0x78,0x40,0x40,0x7C,0x00
    DB 0x7C,0x40,0x40,0x78,0x40,0x40,0x40,0x00
    DB 0x38,0x44,0x40,0x5C,0x44,0x44,0x3C,0x00
    DB 0x44,0x44,0x44,0x7C,0x44,0x44,0x44,0x00
    DB 0x38,0x10,0x10,0x10,0x10,0x10,0x38,0x00
    DB 0x04,0x04,0x04,0x04,0x44,0x44,0x38,0x00
    DB 0x44,0x48,0x50,0x60,0x50,0x48,0x44,0x00
    DB 0x40,0x40,0x40,0x40,0x40,0x40,0x7C,0x00
    DB 0x44,0x6C,0x54,0x44,0x44,0x44,0x44,0x00
    DB 0x44,0x64,0x54,0x4C,0x44,0x44,0x44,0x00
    DB 0x38,0x44,0x44,0x44,0x44,0x44,0x38,0x00
    DB 0x78,0x44,0x44,0x78,0x40,0x40,0x40,0x00
    DB 0x38,0x44,0x44,0x44,0x54,0x48,0x34,0x00
    DB 0x78,0x44,0x44,0x78,0x48,0x44,0x44,0x00
    DB 0x38,0x44,0x40,0x38,0x04,0x44,0x38,0x00
    DB 0x7C,0x10,0x10,0x10,0x10,0x10,0x10,0x00
    DB 0x44,0x44,0x44,0x44,0x44,0x44,0x38,0x00
    DB 0x44,0x44,0x44,0x44,0x44,0x28,0x10,0x00
    DB 0x44,0x44,0x54,0x54,0x54,0x54,0x28,0x00
    DB 0x44,0x44,0x28,0x10,0x28,0x44,0x44,0x00
    DB 0x44,0x44,0x44,0x28,0x10,0x10,0x10,0x00
    DB 0x78,0x08,0x10,0x20,0x40,0x40,0x78,0x00
    DB 0x38,0x20,0x20,0x20,0x20,0x20,0x38,0x00
    DB 0x00,0x40,0x20,0x10,0x08,0x04,0x00,0x00
    DB 0x38,0x08,0x08,0x08,0x08,0x08,0x38,0x00
    DB 0x10,0x28,0x44,0x00,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFC
    DB 0x30,0x30,0x10,0x00,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x38,0x04,0x3C,0x44,0x3C,0x00
    DB 0x40,0x40,0x78,0x44,0x44,0x44,0x78,0x00
    DB 0x00,0x00,0x38,0x44,0x40,0x44,0x38,0x00
    DB 0x04,0x04,0x3C,0x44,0x44,0x44,0x3C,0x00
    DB 0x00,0x00,0x38,0x44,0x78,0x40,0x38,0x00
    DB 0x18,0x20,0x20,0x78,0x20,0x20,0x20,0x00
    DB 0x00,0x00,0x3C,0x44,0x44,0x3C,0x04,0x38
    DB 0x40,0x40,0x70,0x48,0x48,0x48,0x48,0x00
    DB 0x10,0x00,0x10,0x10,0x10,0x10,0x18,0x00
    DB 0x08,0x00,0x18,0x08,0x08,0x08,0x48,0x30
    DB 0x40,0x40,0x48,0x50,0x60,0x50,0x48,0x00
    DB 0x10,0x10,0x10,0x10,0x10,0x10,0x18,0x00
    DB 0x00,0x00,0x68,0x54,0x54,0x44,0x44,0x00
    DB 0x00,0x00,0x70,0x48,0x48,0x48,0x48,0x00
    DB 0x00,0x00,0x38,0x44,0x44,0x44,0x38,0x00
    DB 0x00,0x00,0x78,0x44,0x44,0x44,0x78,0x40
    DB 0x00,0x00,0x3C,0x44,0x44,0x44,0x3C,0x04
    DB 0x00,0x00,0x58,0x24,0x20,0x20,0x70,0x00
    DB 0x00,0x00,0x38,0x40,0x38,0x04,0x38,0x00
    DB 0x00,0x20,0x78,0x20,0x20,0x28,0x10,0x00
    DB 0x00,0x00,0x48,0x48,0x48,0x58,0x28,0x00
    DB 0x00,0x00,0x44,0x44,0x44,0x28,0x10,0x00
    DB 0x00,0x00,0x44,0x44,0x54,0x7C,0x28,0x00
    DB 0x00,0x00,0x48,0x48,0x30,0x48,0x48,0x00
    DB 0x00,0x00,0x48,0x48,0x48,0x38,0x10,0x60
    DB 0x00,0x00,0x78,0x08,0x30,0x40,0x78,0x00
    DB 0x18,0x20,0x20,0x60,0x20,0x20,0x18,0x00
    DB 0x10,0x10,0x10,0x00,0x10,0x10,0x10,0x00
    DB 0x30,0x08,0x08,0x0C,0x08,0x08,0x30,0x00
    DB 0x28,0x50,0x00,0x00,0x00,0x00,0x00,0x00
    DB 0x10,0x38,0x6C,0x44,0x44,0x7C,0x00,0x00
    DB 0x38,0x44,0x40,0x40,0x44,0x38,0x10,0x30
    DB 0x48,0x00,0x48,0x48,0x48,0x58,0x28,0x00
    DB 0x0C,0x00,0x38,0x44,0x78,0x40,0x38,0x00
    DB 0x38,0x00,0x38,0x04,0x3C,0x44,0x3C,0x00
    DB 0x28,0x00,0x38,0x04,0x3C,0x44,0x3C,0x00
    DB 0x30,0x00,0x38,0x04,0x3C,0x44,0x3C,0x00
    DB 0x38,0x28,0x38,0x04,0x3C,0x44,0x3C,0x00
    DB 0x00,0x38,0x44,0x40,0x44,0x38,0x10,0x30
    DB 0x38,0x00,0x38,0x44,0x78,0x40,0x38,0x00
    DB 0x28,0x00,0x38,0x44,0x78,0x40,0x38,0x00
    DB 0x30,0x00,0x38,0x44,0x78,0x40,0x38,0x00
    DB 0x28,0x00,0x10,0x10,0x10,0x10,0x18,0x00
    DB 0x10,0x28,0x00,0x10,0x10,0x10,0x18,0x00
    DB 0x20,0x00,0x10,0x10,0x10,0x10,0x18,0x00
    DB 0x28,0x00,0x10,0x28,0x44,0x7C,0x44,0x00
    DB 0x38,0x28,0x38,0x6C,0x44,0x7C,0x44,0x00
    DB 0x0C,0x00,0x7C,0x40,0x78,0x40,0x7C,0x00
    DB 0x00,0x00,0x78,0x14,0x7C,0x50,0x3C,0x00
    DB 0x3C,0x50,0x50,0x7C,0x50,0x50,0x5C,0x00
    DB 0x38,0x00,0x30,0x48,0x48,0x48,0x30,0x00
    DB 0x28,0x00,0x30,0x48,0x48,0x48,0x30,0x00
    DB 0x60,0x00,0x30,0x48,0x48,0x48,0x30,0x00
    DB 0x38,0x00,0x48,0x48,0x48,0x58,0x28,0x00
    DB 0x60,0x00,0x48,0x48,0x48,0x58,0x28,0x00
    DB 0x28,0x00,0x48,0x48,0x48,0x38,0x10,0x60
    DB 0x48,0x30,0x48,0x48,0x48,0x48,0x30,0x00
    DB 0x28,0x00,0x48,0x48,0x48,0x48,0x30,0x00
    DB 0x00,0x10,0x38,0x40,0x40,0x38,0x10,0x00
    DB 0x18,0x24,0x20,0x78,0x20,0x24,0x5C,0x00
    DB 0x44,0x28,0x10,0x7C,0x10,0x7C,0x10,0x00
    DB 0x60,0x50,0x50,0x68,0x5C,0x48,0x48,0x00
    DB 0x08,0x14,0x10,0x38,0x10,0x10,0x50,0x20
    DB 0x18,0x00,0x38,0x04,0x3C,0x44,0x3C,0x00
    DB 0x18,0x00,0x10,0x10,0x10,0x10,0x18,0x00
    DB 0x18,0x00,0x30,0x48,0x48,0x48,0x30,0x00
    DB 0x18,0x00,0x48,0x48,0x48,0x58,0x28,0x00
    DB 0x28,0x50,0x00,0x70,0x48,0x48,0x48,0x00
    DB 0x28,0x50,0x00,0x48,0x68,0x58,0x48,0x00
    DB 0x38,0x04,0x3C,0x44,0x3C,0x00,0x3C,0x00
    DB 0x30,0x48,0x48,0x48,0x30,0x00,0x78,0x00
    DB 0x10,0x00,0x10,0x30,0x40,0x44,0x38,0x00
    DB 0x00,0x00,0x7C,0x40,0x40,0x40,0x00,0x00
    DB 0x00,0x00,0xFC,0x04,0x04,0x00,0x00,0x00
    DB 0x40,0x48,0x50,0x38,0x44,0x08,0x1C,0x00
    DB 0x40,0x48,0x50,0x2C,0x54,0x1C,0x04,0x00
    DB 0x10,0x00,0x10,0x10,0x38,0x38,0x10,0x00
    DB 0x00,0x00,0x24,0x48,0x24,0x00,0x00,0x00
    DB 0x00,0x00,0x48,0x24,0x48,0x00,0x00,0x00
    DB 0x54,0x00,0xA8,0x00,0x54,0x00,0xA8,0x00
    DB 0x54,0xA8,0x54,0xA8,0x54,0xA8,0x54,0xA8
    DB 0xA8,0xFC,0x54,0xFC,0xA8,0xFC,0x54,0xFC
    DB 0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10
    DB 0x10,0x10,0x10,0xF0,0x10,0x10,0x10,0x10
    DB 0x10,0xF0,0x10,0xF0,0x10,0x10,0x10,0x10
    DB 0x50,0x50,0x50,0xD0,0x50,0x50,0x50,0x50
    DB 0x00,0x00,0x00,0xF0,0x50,0x50,0x50,0x50
    DB 0x00,0xF0,0x10,0xF0,0x10,0x10,0x10,0x10
    DB 0x50,0xD0,0x10,0xD0,0x50,0x50,0x50,0x50
    DB 0x50,0x50,0x50,0x50,0x50,0x50,0x50,0x50
    DB 0x00,0xF0,0x10,0xD0,0x50,0x50,0x50,0x50
    DB 0x50,0xD0,0x10,0xF0,0x00,0x00,0x00,0x00
    DB 0x50,0x50,0x50,0xF0,0x00,0x00,0x00,0x00
    DB 0x10,0xF0,0x10,0xF0,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x00,0xF0,0x10,0x10,0x10,0x10
    DB 0x10,0x10,0x10,0x1C,0x00,0x00,0x00,0x00
    DB 0x10,0x10,0x10,0xFC,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x00,0xFC,0x10,0x10,0x10,0x10
    DB 0x10,0x10,0x10,0x1C,0x10,0x10,0x10,0x10
    DB 0x00,0x00,0x00,0xFC,0x00,0x00,0x00,0x00
    DB 0x10,0x10,0x10,0xFC,0x10,0x10,0x10,0x10
    DB 0x10,0x1C,0x10,0x1C,0x10,0x10,0x10,0x10
    DB 0x50,0x50,0x50,0x5C,0x50,0x50,0x50,0x50
    DB 0x50,0x5C,0x40,0x7C,0x00,0x00,0x00,0x00
    DB 0x00,0x7C,0x40,0x5C,0x50,0x50,0x50,0x50
    DB 0x50,0xDC,0x00,0xFC,0x00,0x00,0x00,0x00
    DB 0x00,0xFC,0x00,0xDC,0x50,0x50,0x50,0x50
    DB 0x50,0x5C,0x40,0x5C,0x50,0x50,0x50,0x50
    DB 0x00,0xFC,0x00,0xFC,0x00,0x00,0x00,0x00
    DB 0x50,0xDC,0x00,0xDC,0x50,0x50,0x50,0x50
    DB 0x10,0xFC,0x00,0xFC,0x00,0x00,0x00,0x00
    DB 0x50,0x50,0x50,0xFC,0x00,0x00,0x00,0x00
    DB 0x00,0xFC,0x00,0xFC,0x10,0x10,0x10,0x10
    DB 0x00,0x00,0x00,0xFC,0x50,0x50,0x50,0x50
    DB 0x50,0x50,0x50,0x7C,0x00,0x00,0x00,0x00
    DB 0x10,0x1C,0x10,0x1C,0x00,0x00,0x00,0x00
    DB 0x00,0x1C,0x10,0x1C,0x10,0x10,0x10,0x10
    DB 0x00,0x00,0x00,0x7C,0x50,0x50,0x50,0x50
    DB 0x50,0x50,0x50,0xDC,0x50,0x50,0x50,0x50
    DB 0x10,0xFC,0x00,0xFC,0x10,0x10,0x10,0x10
    DB 0x10,0x10,0x10,0xF0,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x00,0x1C,0x10,0x10,0x10,0x10
    DB 0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC,0xFC
    DB 0x00,0x00,0x00,0x00,0xFC,0xFC,0xFC,0xFC
    DB 0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0
    DB 0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C,0x1C
    DB 0xFC,0xFC,0xFC,0xFC,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x34,0x48,0x48,0x34,0x00,0x00
    DB 0x00,0x70,0x48,0x70,0x48,0x48,0x70,0x40
    DB 0x78,0x48,0x40,0x40,0x40,0x40,0x40,0x00
    DB 0x00,0x7C,0x28,0x28,0x28,0x28,0x28,0x00
    DB 0x78,0x48,0x20,0x10,0x20,0x48,0x78,0x00
    DB 0x00,0x00,0x3C,0x48,0x48,0x30,0x00,0x00
    DB 0x00,0x00,0x48,0x48,0x48,0x70,0x40,0x40
    DB 0x00,0x00,0x28,0x50,0x10,0x10,0x10,0x00
    DB 0x38,0x10,0x38,0x44,0x38,0x10,0x38,0x00
    DB 0x30,0x48,0x48,0x78,0x48,0x48,0x30,0x00
    DB 0x00,0x38,0x44,0x44,0x28,0x28,0x6C,0x00
    DB 0x30,0x40,0x20,0x10,0x38,0x48,0x30,0x00
    DB 0x00,0x00,0x28,0x54,0x54,0x28,0x00,0x00
    DB 0x00,0x10,0x38,0x54,0x54,0x38,0x10,0x00
    DB 0x00,0x38,0x40,0x78,0x40,0x38,0x00,0x00
    DB 0x00,0x30,0x48,0x48,0x48,0x48,0x00,0x00
    DB 0x00,0x78,0x00,0x78,0x00,0x78,0x00,0x00
    DB 0x00,0x10,0x38,0x10,0x00,0x38,0x00,0x00
    DB 0x40,0x30,0x08,0x30,0x40,0x00,0x78,0x00
    DB 0x08,0x30,0x40,0x30,0x08,0x00,0x78,0x00
    DB 0x00,0x08,0x14,0x10,0x10,0x10,0x10,0x10
    DB 0x10,0x10,0x10,0x10,0x10,0x50,0x20,0x00
    DB 0x00,0x10,0x00,0x7C,0x00,0x10,0x00,0x00
    DB 0x00,0x28,0x50,0x00,0x28,0x50,0x00,0x00
    DB 0x30,0x48,0x48,0x30,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x00,0x30,0x30,0x00,0x00,0x00
    DB 0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x00
    DB 0x00,0x1C,0x10,0x10,0x50,0x50,0x20,0x00
    DB 0x50,0x28,0x28,0x28,0x00,0x00,0x00,0x00
    DB 0x60,0x10,0x20,0x70,0x00,0x00,0x00,0x00
    DB 0x00,0x00,0x78,0x78,0x78,0x78,0x00,0x00
    DB 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00

;Set vram staring address for writting.
;HL stores a 16 bits address.
WriteAddress:
    LD C, VDP_VREG
    OUT (C), L   ; Write low byte.
    LD A, H
    LD B, 0x40
    OR B
    OUT (C), A   ; Write high byte.
    RET

;Write data to vram.
;C: I/O port to write to.
;HL: address of data.
;DE: number of bytes to write.
WriteData:
    OUTI
    DEC DE
    LD A, D
    OR E
    JR NZ, WriteData
    RET

;Write VDP register R0~R7.
;B: byte to write.
;C: register number.
WriteRegister:
    LD A, B
    OUT (VDP_VREG), A
    LD A, C
    OUT (VDP_VREG), A
    RET

;Output message to screen.
;HL: address of message.
WriteString:
    LD A, (HL)
    OR A
    RET Z
    LD C, VDP_VRAM
    OUTI
    JR WriteString

;Initialize VDP and enter text mode.
InitTms9118:
    LD B, 0x00          ;R0: Text Mode,No External Video
    LD C, VDP_R0
    CALL WriteRegister

    LD B, 0xF0          ;R1: 16K,Enable Disp.,Enable Int.
    LD C, VDP_R1
    CALL WriteRegister

    LD B, 0x02          ;R2: Address of Name Table in VRAM = Hex 0800
    LD C, VDP_R2
    CALL WriteRegister

    LD B, 0x00          ;R3: Color Table not used. Color is defined in Reg.7
    LD C, VDP_R3
    CALL WriteRegister

    LD B, 0x00          ;R4: Address of Pattern Table in VRAM = Hex 000
    LD C, VDP_R4
    CALL WriteRegister

    LD B, 0x20          ;R5: Fixed value
    LD C, VDP_R5
    CALL WriteRegister

    LD B, 0x00          ;R6: Fixed value
    LD C, VDP_R6
    CALL WriteRegister

    ;LD B, 0xF5          ;R7: White Text on Light Blue Background
    LD B, 0xF1         ;R7: White Text on Light Black Background
    LD C, VDP_R7
    CALL WriteRegister

    LD HL, 0x0000       ;Initialize pattern table, address=0x0000
    CALL WriteAddress
    LD C, VDP_VRAM      ;Write 256 characters to VRAM.
    LD HL, FontTable
    LD DE, 0x800
    CALL WriteData

    LD HL, 0x0800       ;Clear name table.
    CALL WriteAddress
    LD BC, 960
LOOP:
    LD A, ' '
    OUT (VDP_VRAM), A
    DEC BC
    LD A, B
    OR C
    JR NZ, LOOP
    RET





